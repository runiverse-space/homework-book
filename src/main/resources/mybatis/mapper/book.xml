<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.BookDao">
    <insert id="insert" parameterType="Book">
        <selectKey keyProperty="bid" resultType="int" order="BEFORE"> 
            select seq_book_bid.nextval from dual 
        </selectKey> 
        
        insert into book (bid, btitle, bpublisher, bprice, bauthor, battachoname, battachsname, battachtype, battachdata) 
        values (#{bid}, #{btitle}, #{bpublisher}, #{bprice}, #{bauthor}, #{battachoname}, #{battachsname}, #{battachtype}, #{battachdata}) 
    </insert>

    <select id="selectByBid" parameterType="int" resultType="Book"> 
        select bid, btitle, bpublisher, bprice, bauthor, battachoname, battachsname, battachtype, battachdata 
        from book 
        where bid = #{value} 
    </select>

    <select id="selectByPage" resultType="Book">
      <![CDATA[
      select rnum, bid, btitle, bpublisher, bprice, bauthor
      from (
          select rownum as rnum, bid, btitle, bpublisher, bprice, bauthor
          from (
              select bid, btitle, bpublisher, bprice, bauthor
              from book
              order by bid desc
          )
          where rownum <= #{endRowNo}
      )
      where rnum >= #{startRowNo}
      ]]>
    </select>

    <update id="update" parameterType="Book"> 
        update book 
        set btitle=#{btitle}, bpublisher=#{bpublisher}, bprice=#{bprice}, bauthor=#{bauthor} 
        <if test="battachoname != null"> 
            , battachoname=#{battachoname} 
            , battachsname=#{battachsname} 
            , battachtype=#{battachtype} 
            , battachdata=#{battachdata} 
        </if> 
        where bid=#{bid} 
    </update>

    <select id="countAll"
        resultType="int"> select count(*) from book
    </select>

    <delete id="delete" parameterType="int"> 
        delete from book where bid=#{bid} 
    </delete>
</mapper>